---
title: Code Pipeline
summary: 
categories:
    - 
tags:
    - aws
publish: true
---
## Code Pipeline

- 파이프라인 설정 선택
  - 기본 위치 혹은 사용자 지정위치 지정
  - 사용자 지정의 경우 깃허브 액션 특정 경로에 소스코드 업로드
- 소스 스테이지 추가
  - 소스 공급자에서 코드를 선택
  - 깃허브 버전1과 2는 인증이 다름. 2에서는 토큰 권한이 좀더 세세하게 설정할 수 있음
  - 리포지토리 이름 정하고 브랜치 정하면 끝
- 빌드 스테이지 추가
  - 단일 빌드는 그냥 빌드
  - 배치빌드는 여러 빌드를 단이 실행으로 트리거
  - 빌드할 때 쉘스크립트 정의하여 설정함
- 배포 스테이지 선택
  - 우리는 Code Deploy 쓰고있음. ECS도 쓸 수 있음
  - 앱 이름 정의
  - 그룹 정의
- 변경사항 다시 빌드 누르면 재배포 일어남

## Code Build

- 프로젝트 빌드 미리 만들어놔야함
- 상세한 빌드 설정은 이 메뉴에서 정해야함
- 우리는 빌드 스펙을 쓰고있음
- 배치 구성에서는 배치에 사용되는 사양 등을 정할 수 있음
- 우리는 ECR에 올린 이미지를 사용

## Code Deploy

- 플랫폼은 ECS나 람다, EC2를 사용 가능
- ECS는 그루핑해서 한번에 배포 가능
- 오케스트레이션을 여기서 지정
- 배포그룹
- VPC 설정, 리전 설정, ELB 설정, 권한 등등을 설정해야함

## ECR

- Elastic Container Registry
- 도커 허브와 비슷한 용도
- S3에 올려주고 관리

## ECS

- ECR에서 만들고 해당 도커 실행
- 도커를 SaaS처럼 사용
- 실제 비용 따지고 보면 EC2에 올리는거보다 더 비쌀 수 있음
- 카나리 배포때 사용. ECS에서 설정해놓고 카나리에만 배포하면 됨
