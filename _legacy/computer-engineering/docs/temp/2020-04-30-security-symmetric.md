# 대칭 키 암호

## 개념

* 암호화와 복호화에 하나의 같은 비밀키를 사용하는 방식
* C = Ek(P)
* P = Dk(C)
* 다양한 이름
  * 대칭키 암호, 비밀키 암호, 단일키 암호, 관용 암호

## 블록 암호

* 개념
  * 평문을 고정된 크기의 블록으로 나누어 각 블록마다 암호화 과정을 수행하여 블록 단위로 암호문을 얻는 대칭키 암호 방식
  * 출력 블록의 각 비트는 입력 블록과 키의 모든 비트에 영향을 받음
    * 한 비트가 암호화 될 때 하나의 평문과 암호 비트를 사용하는게 아닌, 블록의 모든 비트와 키의 모든 비트의 영향을 받는다
* 주료 단순한 함수를 반복적으로 적용함으로써 암호학적으로 강한 함수를 만듦
  * 라운드 함수: 반복되는 함수
  * 라운드 키: 라운드 함수에 작용하는 키 -> 키 스케쥴을 사용하여 라운드마다 새 키 사용
  * 키 스케쥴: 키를 입력하여 라운드 키를 발생시키는 과정

* 구조
  * 파이스텔(Feistel) 구조
    * 오른쪽 입력 + 라운드함수를 왼쪽 블럭과 XOR
    * 하나의 입력 블록을 분할하여 좌우 두 개의 블록으로 구분 후 짝수번의 라운드를 진행
    * 각 라운드의 출력 블록이 다음 라운드의 입력 블록이 됨
    * i 번째 라운드 과정 (f: 라운드 함수, Ki: 라운드 키)
      * Li = Ri-1
      * Ri = Li-1 XOR f(Ri-1, Ki)
    * 구조
      * 라운드 함수와 관계 없이 역변환 가능
      * 즉, 암/복호화 과정이 동일 -> 역함수 필요없이 암호화 함수로 복호화 가능
      * 두 번의 수행으로 블록간의 완전한 확산이 이루어짐
      * DES, SEED 등 많은 블록 암호에 사용됨
  * SPN(Substitution치환 Permutation전치 Network) 구조
    * Mixer로 입력값을 섞은 뒤 S-Box로 치환, P-Box에서 자리를 바꿈
    * 하나의 입력 블록을 여러개의 소블록으로 나눈 후 라운드를 진행
    * 각 라운드의 출력 블록이 다음 라운드의 입력 블록이 됨
    * 각 소블록을 S-box로 입력하여 치환 후 S-box의 출력을 P-box로 전치
    * 구조
      * 라운드 함수가 역변환 가능해야 함
      * 더 많은 병렬성 지원
      * AES, ARIA 등 최근의 블록 암호에 사용됨

* 블록 암호의 사용 모드: 각 블록에 블록 암호를 어떤 방식으로 사용할 것이냐에 따라 구분
  * 전자 코드 북(ECB)
    * 평문을 블록으로 쪼개 암호화
    * 각 블록을 독립적으로 암호화
    * 암/복호화 시 병렬처리 가능
    * 하나의 암호문에 오류가 발생해도 다른 블록에 영향 없음
    * 동일한 평문 블록은 동일한 암호문을 생성(패턴 분석 가능) -> 잘 사용하지 않음
  * 암호 블록 연결(CBC, Cipher Block Chaining)
    * 첫 블록은 IV로 XOR시킴. 다음 블록은 이전 블록 암호문으로 XOR
    * 생성한 암호문 블록이 다음 평문에 영햐응ㄹ 줌
    * 동일한 평문 블록도 서로 다른 암호문 생성
    * 암호화는 병렬처리 불가
    * 복호화 시 하나의 암호문에 오류가 발생해도 그 다음 평문 블록 이외에는 영향 없음
    * 암호화 시 평문 블록에 오류가 발생하면 그 다음의 모든 암호문이 영향을 받음 -> **메시지 인증에 사용**
  * 암호 피드백(CFB)
    * IV를 암호화, 평문과 XOR 시켜 암호문 생성
    * 첫 블록 암호문을 두번쨰 블록 IV로 사용, 암호화 하여 XOR
    * 초기치(IV)를 암호화 한 값과 평문 블록을 XOR하여 암호문 블록 생성
    * 그 암호문 블록을 초기치로 하여 다시 암호화한 값과 평문 블록을 XOR하여 다음 암호문 블록 생성
    * 복호화 함수가 필요 없음
    * 암호화 시 평문 블록에 오류가 발생하면 그 다음의 모든 암호문이 영향을 받음 -> **메시지 인증에 사용**
  * 출력 피드백(OFB)
    * CFB와 방식이 같으나, 암호문을 사용하는게 아니라 IV를 암호화 한 값을 사용
    * 초기치(IV)를 암호화하고 그 값을 다시 암호화하는 과정을 반복함으로써 생성된 수열과 평문 블록을 XOR하여 암호문 생성
    * 복호화 함수가 필요 없음
    * 암호문의 오류는 한 블록에만 영향
  * 카운터(CTR)
    * CFB와 같은방식
    * 초기치 IV와 IV + 1, IV + 2 등을 암호화 하여 생성된 수열과 평문 블록을 XOR하여 암호문 생성
    * 암/복호화 시 병렬처리 가능
    * 하나의 암호문에 오류가 발생해도 다른 블록에 영향 없음
    * 동일한 평문 블록도 서로 다른 암호문 생성
    * ECB 모드처럼 간단하지만 안정성 보장

## 스트림 암호

* 평문과 같은 길이의 키 스트림을 생성하여 평문과 키를 비트단위로 XOR하여 암호문을 얻는 대칭키 암호 방식
* 키 스트림
  * 임의의 길이에 평문에 대해 항상 생성 가능
  * 규칙성이 없어 예측 불가능한 랜덤 수열이 가장 안전
  * 의사 랜덤 수욜
    * 자동화된 생성이 가능하면서도 예측이 어려운 수열
* 선형 귀환 시프트 레지스터(LFSR, Linear Feedback Shift Register)
  * 직전 m개의 값을 선형 결함하여 새로운 값을 얻음
  * 최대 2^m - 1개의 키 스트림 주기를 얻을 수 있음 -> 주기성을 가지고있다
  * LFSR을 단독으로 사용하는 것은 쉽게 해독되기 때문에 출력 수열을 비선형 결합하여 스트림 암호를 구성

## 대칭키 암호 알고리즘들

* DES
  * 1977년 미국 NBS(현재 NIST)에서 공표
  * 2001년 새로운 표준 암호 알고리즘인 AES가 공표될 때 까지 널리 이용됨
  * 블록 암호 알고리즘
    * 평문 블록: 64bit
    * 키: 56bit
    * 암호 블록: 64bit
    * 라운드 수: 16
    * 라운드 키: 48bit
  * 파이스텔 구조

* TDEA (Triple Data Encryption Algorithm)
  * 3DES(triple DES): DES를 3회 반복하여 사용
  * DES의 짧은 키 길이로 인한 안정성 문제를 해결
  * DES보다 3배 느림

* AES(Advanced Encryption Standard)
  * 2001년 미국 NIST에서 공표
  * DES를 대신하는 새로운 표준 알고리즘
  * 공모를 통해 Rijndael을 AES로 선정
  * 블록 암호 알고리즘
    * 평문 블록: 128bit
    * 키: 128bit, 192bit, 256bit 중 택일
    * 라운드: 10, 12, 14
    * 암호 블록: 128bit
  * SPN 구조
  * 구조
    * 초기화 함수
    * Nr - I 개의 라운드
    * I개의 라운드
    * 키 생성

